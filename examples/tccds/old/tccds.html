<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<head>
<title>Towards a Collections & Content Development Strategic Plan Examples</title>

<!-- Include external files and scripts here -->
<link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.11/css/jquery.dataTables.min.css" />
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.0.2/css/responsive.dataTables.min.css" />
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/jquery.jqplot.min.css" />
<link rel="stylesheet" type="text/css" href="tccds.css"/>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.3.min.js"></script>
<script type="text/javascript" src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/string.js/3.3.1/string.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.12.0/moment.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.11/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/responsive/2.0.2/js/dataTables.responsive.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/string.js/3.3.1/string.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/jquery.jqplot.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.dateAxisRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.canvasTextRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.canvasAxisTickRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.categoryAxisRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.pointLabels.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.barRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.bubbleRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.highlighter.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.canvasOverlay.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.canvasAxisLabelRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.canvasTextRenderer.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/excanvas.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.cursor.min.js"></script>
<script type="text/javascript" src="js/config.js"></script>
</head>

<body>
<!-- Banner -->
<div id="banner">
	<h1>Towards a Collections & Content Development Strategic Plan Examples</h1>
	<h2>Drivers, Trends, and Community Engagement</h2>
</div>

<!--  The main container for all views -->
<div class="container">

<a href="../../index.html">(Back to All Examples)</a>

<h2>Overview</h2>

<p>In June 2012, the Affinity Group Heads were charged with providing the Harvard Library Board with an analysis of the current and likely future 
state of collection development in institutions of higher education and culture, including best practices and trends based on data gathered internally and externally.</p>

<p>As part of this effort, the Affinity Group Heads conducted interviews of leaders in the field, inside and outside of Harvard University, and accumulated a large amount 
of data pertaining to drivers and trends that influence collections and content development.</p>

<p>In addition, approximately 105 people attended 8 Harvard-wide community discussion sessions. Additional feedback was gathered from other sources as well, 
including several affinity group meetings, committee meetings involving members of the Harvard faculty, and online fora. 
During the community engagement process, participants asked questions and made comments and recommendations about a number of topics pertaining to the draft 
document.</p>

<p>This sample document depicts a summary of data pertaining to Drivers, Trends, and Community Engagement collected during the <em>Towards a Collections & Content Development
Strategic Plan</em> project.</p>

<p>The datasets have been anonymized.</p>

<button id="dataset_button">About the Datasets</button>
<!-- Dialog box for displaying information all dataset information -->
<div class="ui-widget" id="dataset_dialog" title="Dataset Information"><div id="dataset_info"></div></div>
<hr/>

<h2>Drivers</h2>
<h3>Drivers x Mentions</h3>
<p><em>115</em> unique drivers for collections and content development were identified during a series of interviews and working group sessions conducted in 2013.</p>
<blockquote>
<ul>
	<li>
	<p><em>Show Drivers Button</em></p>
	<p>All <em>115</em> drivers are available in a pop-up, sortable chart. Click the button to see them all.</p>
	</li>
	<li>
	<p><em>Bubble Chart: Drivers x Mentions</em></p>
	<p>All drivers are shown, sorted alphabetically along the x-axis.</p>
	<p>The size of the bubble indicates the number of times the driver was mentioned either in interviews (one mention per interview) or in the 
	two working group sessions (one mention per session). As you can see, <em>Funding Constraints</em> were mentioned most frequently.</p>
	<p>Click on a bubble to find out which driver is associated with it.</p> 
	<p>To zoom, select a region on the chart using the mouse. To reset the zoom, double-click on the chart.</p>
	<p>The number of driver</p>
	</li>
	<li>
	<p><em>Frequency Distribution of Driver Mentions</em></p>
	<p>Some drivers were only mentioned a few times during interviews, while others were mentioned many times. The number of mentions is indicated
	on the x axis, the height of the bar indicated the number drivers mentioned the same number of times.</p>
	</li>
</ul>
</blockquote>

<button id="driver_button">Show Drivers</button>

<div id="drivers">
	<div id="driver_bubble"></div><div id="driver_bar"></div>
</div>

<!-- Dialog box for displaying information all drivers -->
<div class="ui-widget" id="driver_dialog" title="Driver Information"><table class="display" id="driver_table"></table></div>

<hr/>
<h2>Trends</h2>
<h3>Trends X Mentions</h3>

<p><em>96</em> unique trends for collections and content development were identified during a series of interviews and working group sessions conducted in 2013.</p>
<blockquote>
<ul>
	<li>
	<p><em>Show Trends Button</em></p>
	<p>All <em>96</em> trends are available in a pop-up, sortable chart. Click the button to see them all.</p>
	</li>
	<li>
	<p><em>Bubble Chart: Drivers x Mentions</em></p>
	<p>All drivers are shown, sorted alphabetically along the x-axis.</p>
	<p>The size of the bubble indicates the number of times the trend was mentioned either in interviews (one mention per interview) or in the 
	two working group sessions (one mention per session). As you can see, <em>Collaborative collections and collections development</em> were mentioned most frequently.</p>
	<p>Click on a bubble to find out which trend is associated with it.</p> 
	<p>To zoom, select a region on the chart using the mouse. To reset the zoom, double-click on the chart.</p>
	<p>The number of driver</p>
	</li>
	<li>
	<p><em>Frequency Distribution of Trend Mentions</em></p>
	<p>Some trends were only mentioned a few times during interviews, while others were mentioned many times. The number of mentions is indicated
	on the x axis, the height of the bar indicated the number trends mentioned the same number of times.</p>
	</li>
</ul>
</blockquote>

<button id="trend_button">Show Trends</button>

<div id="trends">
	<div id="trend_bubble"></div><div id="trend_bar"></div>
</div>

<!-- Dialog box for displaying information all trends -->
<div class="ui-widget" id="trend_dialog" title="Trend Information"><table class="display" id="trend_table"></table></div>

<hr/>
<h2>Community Engagement</h2>
<h3>Community Engagement Actions X Mentions</h3>

<blockquote>
<p><em>43</em> incidents of engagement were categorized.</p>
<p>The bubblechart visualization below shows the frequency (indicated by the notes taken during various engagement sessions) with which participants 
mentioned specific topics. Please note that each participant comment may address multiple topics.</p>
</blockquote>

<button id="engagement_button">Show Engagement Data</button>

<div id="engagements">
	<div id="engagement_bubble"></div><div id="engagement_bar"></div>
</div>

<!-- Dialog box for displaying information all engagement data -->
<div class="ui-widget" id="engagement_dialog" title="Engagement Information"><table class="display" id="engagement_table"></table></div>

<!-- Close of main container -->
</div>

<div>&nbsp;</div>

<!-- Page footer -->
<div id="footer">
	<p class="footer">
	<a href="http://library.harvard.edu">Harvard University Library</a> &#169; 2016+<br/>
	Contact: <a href="mailto:ceilyn_boyd@harvard.edu?subject=Harvard Library TCCDS Example">C. M. Boyd</a>
	</p>
</div>

<script type="text/javascript">
var baseUrl = 'http://localhost/pv/examples'
// Datasets for TCCDS
var datasets = {
	'Drivers': {
		'source_by_topic': baseUrl + '/data/tccds/anonymized_drivers_by_topic.json',
		'source_by_mentions': baseUrl + '/data/tccds/anonymized_drivers_by_mentions.json',
	},
	'Trends':{
		'source_by_topic': baseUrl + '/data/tccds/anonymized_trends_by_topic.json',
		'source_by_mentions': baseUrl + '/data/tccds/anonymized_trends_by_mentions.json',
	},
	'Engagement':{
		'source_by_topic': baseUrl + '/data/tccds/anonymized_engagement_by_topic.json',
		'source_by_mentions': baseUrl + '/data/tccds/anonymized_engagement_by_mentions.json',
	}
};

/**
 * Set up the visualizations for driver mentions
 */

/**
 * Create the drivers bubble chart of number of mentions
 *
 * @param {String}
 * @return {Void}
 */
function createDriversBubbleChart(topicData) {
	// parse the JSON data
	var driverData = JSON.parse(topicData);
	// get just the data, we don't need the metadata
	driverData = driverData['data'];
	// sort the keys alphabetically
	var drivers = _.keys(driverData);
	drivers = drivers.sort();
	
	// enable jqplot plugins
	$.jqplot.config.enablePlugins = true;
	
	//
	// build the driver bubble chart
	//
	var bubbleData = [];
	// create an array of bubble data for each driver based upon its number of mentions
	drivers.forEach(function(driver, index){
		var name = driverData[driver].name;
		var mentions = driverData[driver].mentions;
		bubbleData.push([index, mentions, mentions, name]);
	});
	
	var driverBubbleChart = $.jqplot('driver_bubble', [bubbleData], {
		title: 'Drivers x Mentions' + ' (' + drivers.length + ' drivers in total)',
        seriesDefaults:{
            renderer: $.jqplot.BubbleRenderer,
            rendererOptions: {
                bubbleAlpha: 0.6,
                highlightAlpha: 0.8,
                showLabels: false,
                autoscaleMultiplier: 1.5,
            },
            shadow: true,
            shadowAlpha: 0.05,
        },
        axes: {
            renderer: $.jqplot.CategoryAxisRenderer,
            xaxis: {
            	min: -10,
            	max: 120,
                tickOptions: {
                    formatString: '%d'
                },
                label: 'Driver Index'
            }
        },
        highlighter: {
            tooltipContentEditor: function (str, seriesIndex, pointIndex) {
            	var data = bubbleData[pointIndex];
				var html = '<ul>';
				html = html + '<li><em>Topic: </em>' + S(data[3]).truncate(50).s + '</li>';
				html = html + '<li><em>Index: </em>' + data[0] + '</li>';
				html = html + '<li><em>Total mentions: </em>' + data[2] + '</li>';
				html = html + '</ul>';
                return html;
            },
            sizeAdjust: 10,
            tooltipLocation: 'n',
            tooltipAxes: 'both',
            useAxesFormatters: false
        },
        cursor:{zoom:true}
	});
	
	$('#driver_bubble').bind('jqplotDataClick',
	       function (ev, seriesIndex, pointIndex, data, radius) { 
				var html = '<ul>';
				html = html + '<li>Topic: ' + data[3] + '</li>';
				html = html + '<li>Index: ' + data[0] + '</li>';
				html = html + '<li>Mentions: ' + data[2] + '</li>';			
				html = html + '</ul>';
				$('#driver_info').html(html);
	       });
}

/**
 * Create the drivers frequency of mentions bar chart
 *
 * @param {String}
 * @return {Void}
 */
function createDriversBarChart(mentionsData) {
	// parse the JSON data
	var json = JSON.parse(mentionsData);
	// get just the data, we don't need the metadata
	json = json['data'];
	// sort the keys numerically
	var mentions = _.keys(json);
	// enable jqplot plugins
	$.jqplot.config.enablePlugins = true;
	
	//
	// build the bar chart
	//
	var barData = [];
	mentions.forEach(function(mention, index){
		var list = json[mention];
		barData.push([mention, list.length]);
	});	

	var driverBarChart = $.jqplot('driver_bar', [barData], {
		// get the title of the chart from the data
		title: 'Frequency Distribution of Driver Mentions',
		seriesDefaults: {
			renderer:$.jqplot.BarRenderer,
			// place the numerical values above each bar
			pointLabels: {show: true},
		},
		axesDefaults: {
			tickRenderer: $.jqplot.CanvasAxisTickRenderer,
			tickOptions: {
				fontSize: '9pt'
			}
		},
		axes: {
			yaxis: {
				labelRenderer: $.jqplot.CanvasAxisLabelRenderer,
				label: '# of Drivers',
			},
			xaxis: {
				renderer: $.jqplot.CategoryAxisRenderer,
				label: '# of Mentions'
			}
		},
        highlighter: {
            tooltipContentEditor: function (str, seriesIndex, pointIndex) {
              	var data = barData[pointIndex];
    			var t = (data[1] == 1) ? ' topic ' : ' topics ';
    			var m = (data[0] == 1) ? ' mention' : ' mentions';
    			var html = data[1] + t + ' had ' + data[0] + m;
    			if (data[1] < 9) {
    	  			var topics = '';
    				var val = barData[pointIndex][0];
    				var key = val.toString();
    				json[key].forEach(function(topic){
    					topics = topics + '<li>' + topic.name + '</li>';
    				});
    				html = html + '<ul>' + topics + '</ul>'
    			}
    			return html;
            },
            sizeAdjust: 10,
            tooltipLocation: 'n',
            tooltipAxes: 'both',
            useAxesFormatters: false
        },
	});
}

/**
 * Create the table of data about drivers
 * 
 * @param {String}
 * @return {Object}
 */
function createDriversDataTable(data) {
	// parse the JSON data
	var driverData = JSON.parse(data);
	// get just the data, we don't need the metadata
	driverData = driverData['data'];
	// sort the keys alphabetically
	var drivers = _.keys(driverData);
	// create the data for our table
	var tableData = [];
	drivers.forEach(function(driver, index){
		var name = driverData[driver].name;
		var desc = driverData[driver].description;
		var mentions = driverData[driver].mentions;
		tableData.push([index, name, desc, mentions]);
	});
	
	var driverDataTable = $('#driver_table').removeAttr('width').dataTable({
		'destroy':true, // reset the contents of the table each time the function is invoked
		'data':tableData,
		'columns': [
		            {'title':'Index'},
		            {'title':'Name'},
		            {'title':'Description'},
		            {'title':'Mentions'}],
		'lengthMenu':[[5,10,-1],[5,10,'All']],
        'scrollY':        '200px',
        'scrollX':        true,
        'scrollCollapse': true,
        'paging':         false,
		'fixedColumns':true,
		'columnDefs': [{'width': 200, 'targets':2}]
	});
	// set defaults on the table
    $.extend($.fn.dataTable.defaults, {
        "bPaginate": true,
        "bInfo": true,
    });
	// resize the table to fit the data in the columns
	driverDataTable.fnAdjustColumnSizing();
	driverDataTable.fnSort([[0, 'asc']]);
	
	// return the driver table for later use
	return driverDataTable;
}

/**
 * Set up the visualizations for trends mentions
 */

/**
 * Create the trends bubble chart of number of mentions
 *
 * @param {String}
 * @return {Void}
 */
function createTrendsBubbleChart(topicData) {
	// parse the JSON data
	var trendData = JSON.parse(topicData);
	// get just the data, we don't need the metadata
	trendData = trendData['data'];
	// sort the keys alphabetically
	var trends = _.keys(trendData);
	trends = trends.sort();
	
	// enable jqplot plugins
	$.jqplot.config.enablePlugins = true;
	
	//
	// build the trend bubble chart
	//
	var bubbleData = [];
	// create an array of bubble data for each trend based upon its number of mentions
	trends.forEach(function(trend, index){
		var name = trendData[trend].name;
		var mentions = trendData[trend].mentions;
		bubbleData.push([index, mentions, mentions, name]);
	});
	
	var trendBubbleChart = $.jqplot('trend_bubble', [bubbleData], {
		title: 'Trends x Mentions' + ' (' + trends.length + ' trends in total)',
     seriesDefaults:{
         renderer: $.jqplot.BubbleRenderer,
         rendererOptions: {
             bubbleAlpha: 0.6,
             highlightAlpha: 0.8,
             showLabels: false,
             autoscaleMultiplier: 1.5,
         },
         shadow: true,
         shadowAlpha: 0.05,
     },
     axes: {
         renderer: $.jqplot.CategoryAxisRenderer,
         xaxis: {
         	min: -5,
         	max: 100,
             tickOptions: {
                 formatString: '%d'
             },
             label: 'Trend Index'
         }
     },
     highlighter: {
         tooltipContentEditor: function (str, seriesIndex, pointIndex) {
         	var data = bubbleData[pointIndex];
				var html = '<ul>';
				html = html + '<li><em>Topic: </em>' + S(data[3]).truncate(50).s + '</li>';
				html = html + '<li><em>Index: </em>' + data[0] + '</li>';
				html = html + '<li><em>Mentions: </em>' + data[2] + '</li>'; 
				html = html + '</ul>';
             return html;
         },
         sizeAdjust: 10,
         tooltipLocation: 'n',
         tooltipAxes: 'both',
         useAxesFormatters: false
     },
     cursor:{zoom:true}
	});
	
	$('#trend_bubble').bind('jqplotDataClick',
	       function (ev, seriesIndex, pointIndex, data, radius) { 
				var html = '<ul>';
				html = html + '<li>Topic: ' + data[3] + '</li>';
				html = html + '<li>Index: ' + data[0] + '</li>';
				html = html + '<li>Mentions: ' + data[2] + '</li>';		
				html = html + '</ul>';
				$('#trend_info').html(html);
	       });
}

/**
 * Create the trends frequency of mentions bar chart
 *
 * @param {String}
 * @return {Void}
 */
function createTrendsBarChart(mentionsData) {
	// parse the JSON data
	var json = JSON.parse(mentionsData);
	// get just the data, we don't need the metadata
	json = json['data'];
	// sort the keys numerically
	var mentions = _.keys(json);
	// enable jqplot plugins
	$.jqplot.config.enablePlugins = true;
	
	//
	// build the bar chart
	//
	var barData = [];
	mentions.forEach(function(mention, index){
		var list = json[mention];
		barData.push([mention, list.length]);
	});	

	var trendBarChart = $.jqplot('trend_bar', [barData], {
		// get the title of the chart from the data
		title: 'Frequency Distribution of Trend Mentions',
		seriesDefaults: {
			renderer:$.jqplot.BarRenderer,
			// place the numerical values above each bar
			pointLabels: {show: true},
		},
		axesDefaults: {
			tickRenderer: $.jqplot.CanvasAxisTickRenderer,
			tickOptions: {
				fontSize: '9pt'
			}
		},
		axes: {
			yaxis: {
				labelRenderer: $.jqplot.CanvasAxisLabelRenderer,
				label: '# of Trends',
			},
			xaxis: {
				renderer: $.jqplot.CategoryAxisRenderer,
				label: '# of Mentions'
			}
		},
     highlighter: {
         tooltipContentEditor: function (str, seriesIndex, pointIndex) {
          	var data = barData[pointIndex];
			var t = (data[1] == 1) ? ' topic ' : ' topics ';
			var m = (data[0] == 1) ? ' mention' : ' mentions';
			var html = data[1] + t + ' had ' + data[0] + m;
			if (data[1] < 7) {
	  			var topics = '';
				var val = barData[pointIndex][0];
				var key = val.toString();
				json[key].forEach(function(topic){
					topics = topics + '<li>' + topic.name + '</li>';
				});
				html = html + '<ul>' + topics + '</ul>'
			}
			return html;
         },
         sizeAdjust: 10,
         tooltipLocation: 'n',
         tooltipAxes: 'both',
         useAxesFormatters: false
     },
	});
}

/**
 * Create the table of data about trends
 * 
 * @param {String}
 * @return {Object}
 */
function createTrendsDataTable(data) {
	// parse the JSON data
	var trendData = JSON.parse(data);
	// get just the data, we don't need the metadata
	trendData = trendData['data'];
	// sort the keys alphabetically
	var trends = _.keys(trendData);
	// create the data for our table
	var tableData = [];
	trends.forEach(function(trend, index){
		var name = trendData[trend].name;
		var desc = trendData[trend].description;
		var mentions = trendData[trend].mentions;
		tableData.push([index, name, desc, mentions]);
	});
	
	var trendDataTable = $('#trend_table').removeAttr('width').dataTable({
		'destroy':true, // reset the contents of the table each time the function is invoked
		'data':tableData,
		'columns': [
		            {'title':'Index'},
		            {'title':'Name'},
		            {'title':'Description'},
		            {'title':'Mentions'}],
		'lengthMenu':[[5,10,-1],[5,10,'All']],
     'scrollY':        '200px',
     'scrollX':        true,
     'scrollCollapse': true,
     'paging':         false,
		'fixedColumns':true,
		'columnDefs': [{'width': 200, 'targets':2}]
	});
	// set defaults on the table
 $.extend($.fn.dataTable.defaults, {
     "bPaginate": true,
     "bInfo": true,
 });
	// resize the table to fit the data in the columns
	trendDataTable.fnAdjustColumnSizing();
	trendDataTable.fnSort([[0, 'asc']]);
	
	// return the trends data table for later use
	return trendDataTable;
}

/**
 * Process engagement data and set up visualizations
 */

/**
 * Create the engagements bubble chart of number of mentions
 *
 * @param {String}
 * @return {Void}
 */
function createEngagementBubbleChart(topicData) {
	// parse the JSON data
	var engagementData = JSON.parse(topicData);
	// get just the data, we don't need the metadata
	engagementData = engagementData['data'];
	// sort the keys alphabetically
	var engagements = _.keys(engagementData);
	engagements = engagements.sort();
	
	// enable jqplot plugins
	$.jqplot.config.enablePlugins = true;
	
	//
	// build the engagement bubble chart
	//
	var bubbleData = [];
	// create an array of bubble data for each engagement based upon its number of mentions
	engagements.forEach(function(engagement, index){
		var mentions = engagementData[engagement];
		bubbleData.push([index, mentions, mentions, engagement]);
	});
	
	var engagementBubbleChart = $.jqplot('engagement_bubble', [bubbleData], {
		title: 'Engagements x Mentions' + ' (' + engagements.length + ' engagements in total)',
     seriesDefaults:{
         renderer: $.jqplot.BubbleRenderer,
         rendererOptions: {
             bubbleAlpha: 0.6,
             highlightAlpha: 0.8,
             showLabels: false,
             autoscaleMultiplier: 1.5,
         },
         shadow: true,
         shadowAlpha: 0.05,
     },
     axes: {
         renderer: $.jqplot.CategoryAxisRenderer,
         xaxis: {
         	min: -2,
         	max: 45,
             tickOptions: {
                 formatString: '%d'
             },
             label: 'Engagement Index'
         }
     },
     highlighter: {
         tooltipContentEditor: function (str, seriesIndex, pointIndex) {
         	var data = bubbleData[pointIndex];
				var html = '<ul>';
				html = html + '<li><em>Topic: </em>' + S(data[3]).truncate(50).s + '</li>';
				html = html + '<li><em>Index: </em>' + data[0] + '</li>';
				html = html + '<li><em>Total mentions: </em>' + data[2] + '</li>';
				html = html + '</ul>';
             return html;
         },
         sizeAdjust: 10,
         tooltipLocation: 'n',
         tooltipAxes: 'both',
         useAxesFormatters: false
     },
     cursor:{zoom:true}
	});
	
	$('#engagement_bubble').bind('jqplotDataClick',
	       function (ev, seriesIndex, pointIndex, data, radius) { 
				var html = '<ul>';
				html = html + '<li>Topic: ' + data[3] + '</li>';
				html = html + '<li>Index: ' + data[0] + '</li>';
				html = html + '<li>Total mentions: ' + data[2] + '</li>';
				html = html + '</ul>';
				$('#engagement_info').html(html);
	       });
}

/**
 * Create the engagements frequency of mentions bar chart
 *
 * @param {String}
 * @return {Void}
 */
function createEngagementBarChart(mentionsData) {
	// parse the JSON data
	var json = JSON.parse(mentionsData);
	// get just the data, we don't need the metadata
	json = json['data'];
	// sort the keys numerically
	var mentions = _.keys(json);
	// enable jqplot plugins
	$.jqplot.config.enablePlugins = true;
	
	//
	// build the bar chart
	//
	var barData = [];
	mentions.forEach(function(mention, index){
		var list = json[mention];
		barData.push([mention, list.length]);
	});	

	var engagementBarChart = $.jqplot('engagement_bar', [barData], {
		// get the title of the chart from the data
		title: 'Frequency Distribution of Engagement Mentions',
		seriesDefaults: {
			renderer:$.jqplot.BarRenderer,
			// place the numerical values above each bar
			pointLabels: {show: true},
		},
		axesDefaults: {
			tickRenderer: $.jqplot.CanvasAxisTickRenderer,
			tickOptions: {
				fontSize: '9pt'
			}
		},
		axes: {
			yaxis: {
				labelRenderer: $.jqplot.CanvasAxisLabelRenderer,
				label: '# of Engagements',
			},
			xaxis: {
				renderer: $.jqplot.CategoryAxisRenderer,
				label: '# of Mentions'
			}
		},
     highlighter: {
         tooltipContentEditor: function (str, seriesIndex, pointIndex) {
         	var data = barData[pointIndex];
			var topics = '';
			var val = barData[pointIndex][0];
			var key = val.toString();
			json[key].forEach(function(topic){
				topics = topics + '<li>' + topic + '</li>';
			});
			var t = (data[1] == 1) ? ' topic ' : ' topics ';
			var m = (data[0] == 1) ? ' mention' : ' mentions';
			var html = data[1] + t + ' had ' + data[0] + m;
			html = html + '<ul>' + topics + '</ul>'
			return html;
         },
         sizeAdjust: 10,
         tooltipLocation: 'n',
         tooltipAxes: 'both',
         useAxesFormatters: false
     },
	});
}

/**
 * Create the table of data about engagements
 *
 * @param {String}
 * @return {Object}
 */
function createEngagementDataTable(data) {
	// parse the JSON data
	var engagementData = JSON.parse(data);
	// get just the data, we don't need the metadata
	engagementData = engagementData['data'];
	// sort the keys alphabetically
	var engagements = _.keys(engagementData);
	// create the data for our table
	var tableData = [];
	engagements.forEach(function(engagement, index){
		var mentions = engagementData[engagement];
		tableData.push([index, engagement, mentions]);
	});

	var engagementDataTable = $('#engagement_table').removeAttr('width').dataTable({
		'destroy':true, // reset the contents of the table each time the function is invoked
		'data':tableData,
		'columns': [
		            {'title':'Index'},
		            {'title':'Name'},
		            {'title':'Mentions'}],
		'lengthMenu':[[5,10,-1],[5,10,'All']],
     'scrollY':        '200px',
     'scrollX':        true,
     'scrollCollapse': true,
     'paging':         false,
		'fixedColumns':true,
		'columnDefs': [{'width': 200, 'targets':1}]
	});
	// set defaults on the table
 $.extend($.fn.dataTable.defaults, {
     "bPaginate": true,
     "bInfo": true,
 });
	// resize the table to fit the data in the columns
	engagementDataTable.fnAdjustColumnSizing();
	engagementDataTable.fnSort([[0, 'asc']]);
	
	// return the engagement data table for later use
	return engagementDataTable;
}
 
/**
 * Given a metadata object, add its contents to the
 * datasets dialog
 */
function addDatasetMetadata(dataset, metadata) {
	$('#dataset_dialog').dialog('close');
	var keys = _.keys(metadata);
	$('#dataset_info').append('<p><em>' + dataset + '</em><br/>');
	$('#dataset_info').append('<ul>');
	keys.forEach(function(key){
		$('#dataset_info').append('<li><em>' + key + '</em>: ' + metadata[key]);
	});
	$('#dataset_info').append('</ul></p>');	
	$('#dataset_dialog').dialog('close');
}

// 
//
// Initialize the user interface
//
$(document).ready(function(){
	// initialize driver ui elements
	$('#driver_dialog').dialog({
		modal: true,
		buttons: {
		  Ok: function() {
		    $(this).dialog('close');
		  }
		}
	});
	$('#driver_dialog').dialog({'minWidth':500});
	$('#driver_dialog').dialog('close');
	$('#driver_button').button().click(function(event) {
        $('#driver_dialog').dialog('open');
    });
	
	$('#dataset_dialog').dialog({
		modal: true,
		buttons: {
		  Ok: function() {
		    $(this).dialog('close');
		  }
		}
	});
	$('#dataset_dialog').dialog('close');
	$('#dataset_dialog').dialog({'minWidth':600});
	$('#dataset_button').button().click(function(event) {
        $('#dataset_dialog').dialog('open');
    });
	
	//
	// set up driver visualizations
	//
	
	// create the drivers bubble chart
	$.ajax({
		url: datasets['Drivers'].source_by_topic,
		dataType: 'text'
	}).done(function(data){
		// add dataset information to the dataset dialog box
		var metadata = JSON.parse(data)['metadata'];
		addDatasetMetadata('Drivers x Mentions', metadata);
		// create the drivers bubble chart
		createDriversBubbleChart(data);
		// create the table data
		var driversTable = createDriversDataTable(data);
		driversTable.fnDraw();
	}).fail(function(){
		alert('Read of: ' + url + ' failed.');
	});
	
	// create the drivers bar chart
	$.ajax({
		url: datasets['Drivers'].source_by_mentions,
		dataType: 'text'
	}).done(function(data){
		var metadata = JSON.parse(data)['metadata'];
		addDatasetMetadata('Frequency of Driver Mentions', metadata);
		// create the drivers bar chart
		createDriversBarChart(data);
	}).fail(function(){
		alert('Read of: ' + url + ' failed.');
	});
	
	// initialize trend ui elements
	$('#trend_dialog').dialog({
		modal: true,
		buttons: {
		  Ok: function() {
		    $(this).dialog('close');
		  }
		}
	});
	$('#trend_dialog').dialog({'minWidth':500});
	$('#trend_dialog').dialog('close');
	$('#trend_button').button().click(function(event) {
        $('#trend_dialog').dialog('open');
    });
	
	// create the trends bubble chart
	$.ajax({
		url: datasets['Trends'].source_by_topic,
		dataType: 'text'
	}).done(function(data){
		var metadata = JSON.parse(data)['metadata'];
		addDatasetMetadata('Trends x Mentions', metadata);
		// add dataset information to the 
		// create the trends bubble chart
		createTrendsBubbleChart(data);
		// create the table data
		var trendsTable = createTrendsDataTable(data);
		trendsTable.fnDraw();
	}).fail(function(){
		alert('Read of: ' + url + ' failed.');
	});
	
	// create the trends bar chart
	$.ajax({
		url: datasets['Trends'].source_by_mentions,
		dataType: 'text'
	}).done(function(data){
		var metadata = JSON.parse(data)['metadata'];
		addDatasetMetadata('Frequency of Trend Mentions', metadata);
		// create the trends bar chart
		createTrendsBarChart(data);
	}).fail(function(){
		alert('Read of: ' + url + ' failed.');
	});
	
	// initialize engagement ui elements
	$('#engagement_dialog').dialog({
		modal: true,
		buttons: {
		  Ok: function() {
		    $(this).dialog('close');
		  }
		}
	});
	
	$('#engagement_dialog').dialog({'minWidth':500});
	$('#engagement_dialog').dialog('close');
	$('#engagement_button').button().click(function(event) {
        $('#engagement_dialog').dialog('open');
    });
	
	// create the engagements bubble chart
	$.ajax({
		url: datasets['Engagement'].source_by_topic,
		dataType: 'text'
	}).done(function(data){
		var metadata = JSON.parse(data)['metadata'];
		addDatasetMetadata('Engagement Topics x Mention', metadata);
		// create the engagements bubble chart
		createEngagementBubbleChart(data);
		// create the table data
		var engagementTable = createEngagementDataTable(data);
		engagementTable.fnDraw();
	}).fail(function(){
		alert('Read of: ' + url + ' failed.');
	});
	
	// create the engagements bar chart
	$.ajax({
		url: datasets['Engagement'].source_by_mentions,
		dataType: 'text'
	}).done(function(data){
		var metadata = JSON.parse(data)['metadata'];
		addDatasetMetadata('Frequency of Engagement Topic Mentions', metadata);
		// create the engagements bar chart
		createEngagementBarChart(data);
	}).fail(function(){
		alert('Read of: ' + url + ' failed.');
	});
});
</script>

</body>
</html>
