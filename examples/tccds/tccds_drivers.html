<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<head>
<title>Towards a Collections & Content Development Strategic Plan Examples: Drivers</title>

<!-- Include external files and scripts here -->
<link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.11/css/jquery.dataTables.min.css" />
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.0.2/css/responsive.dataTables.min.css" />
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/jquery.jqplot.min.css" />
<link rel="stylesheet" type="text/css" href="tccds.css"/>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.3.min.js"></script>
<script type="text/javascript" src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/string.js/3.3.1/string.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.12.0/moment.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.11/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/responsive/2.0.2/js/dataTables.responsive.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/string.js/3.3.1/string.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/jquery.jqplot.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.dateAxisRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.canvasTextRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.canvasAxisTickRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.categoryAxisRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.pointLabels.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.barRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.bubbleRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.highlighter.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.canvasOverlay.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.canvasAxisLabelRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.canvasTextRenderer.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/excanvas.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.cursor.min.js"></script>
<script type="text/javascript" src="../../js/config.js"></script>
</head>

<body>
<!-- Banner -->
<div id="banner">
	<h1>Practical Data* Visualization with JavaScript</h1>
	<h2>When, *What, and How</h2>
</div>

<!--  The main container for all views -->
<div class="container">

<a href="../../index.html">(Back to All Examples)</a>

<h2>Towards a Collections & Content Development Strategic Plan Examples</h2>

<h3>Drivers</h3>
<h4>Drivers x Mentions</h4>
<p><em>115</em> unique drivers for collections and content development were identified during a series of interviews and working group sessions conducted in 2013.</p>
<blockquote>
<ul>
	<li>
	<p><em>Show Drivers Button</em></p>
	<p>All <em>115</em> drivers are available in a pop-up, sortable chart. Click the button to see them all.</p>
	</li>
	<li>
	<p><em>Bubble Chart: Drivers x Mentions</em></p>
	<p>All drivers are shown, sorted alphabetically along the x-axis.</p>
	<p>The size of the bubble indicates the number of times the driver was mentioned either in interviews (one mention per interview) or in the 
	two working group sessions (one mention per session). As you can see, <em>Funding Constraints</em> were mentioned most frequently.</p>
	<p>Click on a bubble to find out which driver is associated with it.</p> 
	<p>To zoom, select a region on the chart using the mouse. To reset the zoom, double-click on the chart.</p>
	<p>The number of driver</p>
	</li>
	<li>
	<p><em>Frequency Distribution of Driver Mentions</em></p>
	<p>Some drivers were only mentioned a few times during interviews, while others were mentioned many times. The number of mentions is indicated
	on the x axis, the height of the bar indicated the number drivers mentioned the same number of times.</p>
	</li>
</ul>
</blockquote>

<button id="driver_button">Show Drivers</button>

<div id="drivers">
	<div id="driver_bubble"></div><div id="driver_bar"></div>
</div>

<!-- Dialog box for displaying information all drivers -->
<div class="ui-widget" id="driver_dialog" title="Driver Information"><table class="display" id="driver_table"></table></div>

<!-- Close of main container -->
</div>

<div>&nbsp;</div>

<!-- Page footer -->
<div id="footer">
	<p class="footer">
	<a href="http://library.harvard.edu">Harvard University Library</a> &#169; 2016+<br/>
	Contact: <a href="mailto:ceilyn_boyd@harvard.edu?subject=Practical Data Visualization with JavaScript">C. M. Boyd</a>
	</p>
</div>

<script type="text/javascript">
var dataDirectory = Config.getDataDirectory();
// Drivers datasets
var datasets = {
	'Drivers': {
		'source_by_topic': dataDirectory + '/tccds/anonymized_drivers_by_topic.json',
		'source_by_mentions': dataDirectory + '/tccds/anonymized_drivers_by_mentions.json',
	}
};

/**
 * Set up the visualizations for driver mentions
 */

/**
 * Create the drivers bubble chart of number of mentions
 *
 * @param {String}
 * @return {Void}
 */
function createDriversBubbleChart(topicData) {
	// parse the JSON data
	var driverData = JSON.parse(topicData);
	// get just the data, we don't need the metadata
	driverData = driverData['data'];
	// sort the keys alphabetically
	var drivers = _.keys(driverData);
	drivers = drivers.sort();
	
	// enable jqplot plugins
	$.jqplot.config.enablePlugins = true;
	
	//
	// build the driver bubble chart
	//
	
	// create an array to hold the processed data
	var bubbleData = [];
	// create an array of bubble data for each driver based upon its number of mentions
	drivers.forEach(function(driver, index){
		var name = driverData[driver].name;
		var mentions = driverData[driver].mentions;
		bubbleData.push([index, mentions, mentions, name]);
	});
	
	// create the bubble chart
	// use many of the defaults from the jqplot examples
	var driverBubbleChart = $.jqplot('driver_bubble', [bubbleData], {
		title: 'Drivers x Mentions' + ' (' + drivers.length + ' drivers in total)',
        seriesDefaults:{
            renderer: $.jqplot.BubbleRenderer,
            rendererOptions: {
                bubbleAlpha: 0.6,
                highlightAlpha: 0.8,
                showLabels: false,
                autoscaleMultiplier: 1.5,
            },
            shadow: true,
            shadowAlpha: 0.05,
        },
        axes: {
            renderer: $.jqplot.CategoryAxisRenderer,
            xaxis: {
            	min: -10,
            	max: 120,
                tickOptions: {
                    formatString: '%d'
                },
                label: 'Driver Index'
            }
        },
        // create a custom highligher
        highlighter: {
            tooltipContentEditor: function (str, seriesIndex, pointIndex) {
            	var data = bubbleData[pointIndex];
				var html = '<ul>';
				html = html + '<li><em>Topic: </em>' + S(data[3]).truncate(50).s + '</li>';
				html = html + '<li><em>Index: </em>' + data[0] + '</li>';
				html = html + '<li><em>Total mentions: </em>' + data[2] + '</li>';
				html = html + '</ul>';
                return html;
            },
            sizeAdjust: 10,
            tooltipLocation: 'n',
            tooltipAxes: 'both',
            useAxesFormatters: false
        },
        cursor:{zoom:true}
	});
	
	// add the bubble chart to the HTML DOM element
	$('#driver_bubble').bind('jqplotDataClick',
	       function (ev, seriesIndex, pointIndex, data, radius) { 
				var html = '<ul>';
				html = html + '<li>Topic: ' + data[3] + '</li>';
				html = html + '<li>Index: ' + data[0] + '</li>';
				html = html + '<li>Mentions: ' + data[2] + '</li>';			
				html = html + '</ul>';
				$('#driver_info').html(html);
	       });
}

/**
 * Create the drivers frequency of mentions bar chart
 *
 * @param {String}
 * @return {Void}
 */
function createDriversBarChart(mentionsData) {
	// parse the JSON data
	var json = JSON.parse(mentionsData);
	// get just the data, we don't need the metadata
	json = json['data'];
	// sort the keys numerically
	var mentions = _.keys(json);
	// enable jqplot plugins
	$.jqplot.config.enablePlugins = true;
	
	//
	// build the bar chart
	//
	var barData = [];
	mentions.forEach(function(mention, index){
		var list = json[mention];
		barData.push([mention, list.length]);
	});	

	var driverBarChart = $.jqplot('driver_bar', [barData], {
		// get the title of the chart from the data
		title: 'Frequency Distribution of Driver Mentions',
		seriesDefaults: {
			renderer:$.jqplot.BarRenderer,
			// place the numerical values above each bar
			pointLabels: {show: true},
		},
		axesDefaults: {
			tickRenderer: $.jqplot.CanvasAxisTickRenderer,
			tickOptions: {
				fontSize: '9pt'
			}
		},
		axes: {
			yaxis: {
				labelRenderer: $.jqplot.CanvasAxisLabelRenderer,
				label: '# of Drivers',
			},
			xaxis: {
				renderer: $.jqplot.CategoryAxisRenderer,
				label: '# of Mentions'
			}
		},
        highlighter: {
            tooltipContentEditor: function (str, seriesIndex, pointIndex) {
              	var data = barData[pointIndex];
    			var t = (data[1] == 1) ? ' topic ' : ' topics ';
    			var m = (data[0] == 1) ? ' mention' : ' mentions';
    			var html = data[1] + t + ' had ' + data[0] + m;
    			if (data[1] < 9) {
    	  			var topics = '';
    				var val = barData[pointIndex][0];
    				var key = val.toString();
    				json[key].forEach(function(topic){
    					topics = topics + '<li>' + topic.name + '</li>';
    				});
    				html = html + '<ul>' + topics + '</ul>'
    			}
    			return html;
            },
            sizeAdjust: 10,
            tooltipLocation: 'n',
            tooltipAxes: 'both',
            useAxesFormatters: false
        },
	});
}

/**
 * Create the table of data about drivers
 * 
 * @param {String}
 * @return {Object}
 */
function createDriversDataTable(data) {
	// parse the JSON data
	var driverData = JSON.parse(data);
	// get just the data, we don't need the metadata
	driverData = driverData['data'];
	// sort the keys alphabetically
	var drivers = _.keys(driverData);
	// create the data for our table
	var tableData = [];
	drivers.forEach(function(driver, index){
		var name = driverData[driver].name;
		var desc = driverData[driver].description;
		var mentions = driverData[driver].mentions;
		tableData.push([index, name, desc, mentions]);
	});
	
	var driverDataTable = $('#driver_table').removeAttr('width').dataTable({
		'destroy':true, // reset the contents of the table each time the function is invoked
		'data':tableData,
		'columns': [
		            {'title':'Index'},
		            {'title':'Name'},
		            {'title':'Description'},
		            {'title':'Mentions'}],
		'lengthMenu':[[5,10,-1],[5,10,'All']],
        'scrollY':        '200px',
        'scrollX':        true,
        'scrollCollapse': true,
        'paging':         false,
		'fixedColumns':true,
		'columnDefs': [{'width': 200, 'targets':2}]
	});
	// set defaults on the table
    $.extend($.fn.dataTable.defaults, {
        "bPaginate": true,
        "bInfo": true,
    });
	// resize the table to fit the data in the columns
	driverDataTable.fnAdjustColumnSizing();
	driverDataTable.fnSort([[0, 'asc']]);
	
	// return the driver table for later use
	return driverDataTable;
}

/**
 * Given a metadata object, add its contents to the
 * datasets dialog
 * 
 * @param {String} The name of the dataset 
 * @param {Object} The metadata for the dataset
 * @return {Void}
 */
function addDatasetMetadata(dataset, metadata) {
	$('#dataset_dialog').dialog('close');
	var keys = _.keys(metadata);
	$('#dataset_info').append('<p><em>' + dataset + '</em><br/>');
	$('#dataset_info').append('<ul>');
	keys.forEach(function(key){
		$('#dataset_info').append('<li><em>' + key + '</em>: ' + metadata[key]);
	});
	$('#dataset_info').append('</ul></p>');	
	$('#dataset_dialog').dialog('close');
}

// 
//
// Initialize the UI elements
//
$(document).ready(function(){
	// initialize driver ui elements
	$('#driver_dialog').dialog({
		modal: true,
		buttons: {
		  Ok: function() {
		    $(this).dialog('close');
		  }
		}
	});
	$('#driver_dialog').dialog({'minWidth':500});
	$('#driver_dialog').dialog('close');
	$('#driver_button').button().click(function(event) {
        $('#driver_dialog').dialog('open');
    });
	
	//
	// Set up Driver visualizations
	//
	
	// Create the drivers bubble chart
	$.ajax({
		url: datasets['Drivers'].source_by_topic,
		dataType: 'text'
	}).done(function(data){
		// add dataset information to the dataset dialog box
		var metadata = JSON.parse(data)['metadata'];
		addDatasetMetadata('Drivers x Mentions', metadata);
		// create the drivers bubble chart
		createDriversBubbleChart(data);
		// create the table data
		var driversTable = createDriversDataTable(data);
		// force the refresh of the table
		driversTable.fnDraw();
	}).fail(function(){
		alert('Read of: ' + url + ' failed.');
	});
	
	// create the drivers bar chart
	$.ajax({
		url: datasets['Drivers'].source_by_mentions,
		dataType: 'text'
	}).done(function(data){
		var metadata = JSON.parse(data)['metadata'];
		addDatasetMetadata('Frequency of Driver Mentions', metadata);
		// create the drivers bar chart
		createDriversBarChart(data);
	}).fail(function(){
		alert('Read of: ' + url + ' failed.');
	});
});
</script>

</body>
</html>
