<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<head>
<title>Towards a Collections & Content Development Strategic Plan Examples: Trends</title>

<!-- Include external files and scripts here -->
<link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.11/css/jquery.dataTables.min.css" />
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.0.2/css/responsive.dataTables.min.css" />
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/jquery.jqplot.min.css" />
<link rel="stylesheet" type="text/css" href="tccds.css"/>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.3.min.js"></script>
<script type="text/javascript" src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/string.js/3.3.1/string.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.12.0/moment.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.11/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/responsive/2.0.2/js/dataTables.responsive.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/string.js/3.3.1/string.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/jquery.jqplot.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.dateAxisRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.canvasTextRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.canvasAxisTickRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.categoryAxisRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.pointLabels.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.barRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.bubbleRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.highlighter.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.canvasOverlay.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.canvasAxisLabelRenderer.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.canvasTextRenderer.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/excanvas.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqPlot/1.0.8/plugins/jqplot.cursor.min.js"></script>
<script type="text/javascript" src="../../js/config.js"></script>
</head>

<body>
<!-- Banner -->
<div id="banner">
	<h1>Practical Data* Visualization with JavaScript</h1>
	<h2>When, *What, and How</h2>
</div>

<!--  The main container for all views -->
<div class="container">

<a href="../../index.html">(Back to All Examples)</a>

<h2>Towards a Collections & Content Development Strategic Plan Examples</h2>


<h3>Trends</h3>
<h4>Trends X Mentions</h4>

<p><em>96</em> unique trends for collections and content development were identified during a series of interviews and working group sessions conducted in 2013.</p>
<blockquote>
<ul>
	<li>
	<p><em>Show Trends Button</em></p>
	<p>All <em>96</em> trends are available in a pop-up, sortable chart. Click the button to see them all.</p>
	</li>
	<li>
	<p><em>Bubble Chart: Drivers x Mentions</em></p>
	<p>All drivers are shown, sorted alphabetically along the x-axis.</p>
	<p>The size of the bubble indicates the number of times the trend was mentioned either in interviews (one mention per interview) or in the 
	two working group sessions (one mention per session). As you can see, <em>Collaborative collections and collections development</em> were mentioned most frequently.</p>
	<p>Click on a bubble to find out which trend is associated with it.</p> 
	<p>To zoom, select a region on the chart using the mouse. To reset the zoom, double-click on the chart.</p>
	<p>The number of driver</p>
	</li>
	<li>
	<p><em>Frequency Distribution of Trend Mentions</em></p>
	<p>Some trends were only mentioned a few times during interviews, while others were mentioned many times. The number of mentions is indicated
	on the x axis, the height of the bar indicated the number trends mentioned the same number of times.</p>
	</li>
</ul>
</blockquote>

<button id="trend_button">Show Trends</button>

<div id="trends">
	<div id="trend_bubble"></div><div id="trend_bar"></div>
</div>

<!-- Dialog box for displaying information all trends -->
<div class="ui-widget" id="trend_dialog" title="Trend Information"><table class="display" id="trend_table"></table></div>

<!-- Close of main container -->
</div>

<div>&nbsp;</div>

<!-- Page footer -->
<div id="footer">
	<p class="footer">
	<a href="http://library.harvard.edu">Harvard University Library</a> &#169; 2016+<br/>
	Contact: <a href="mailto:ceilyn_boyd@harvard.edu?subject=Practical Data Visualization with JavaScript">C. M. Boyd</a>
	</p>
</div>

<script type="text/javascript">
var dataDirectory = Config.getDataDirectory();
// Trends datasets
var datasets = {
	'Trends':{
		'source_by_topic': dataDirectory + '/tccds/anonymized_trends_by_topic.json',
		'source_by_mentions': dataDirectory + '/tccds/anonymized_trends_by_mentions.json',
	}
};

/**
 * Set up the visualizations for trends mentions
 */

/**
 * Create the trends bubble chart of number of mentions
 *
 * @param {String}
 * @return {Void}
 */
function createTrendsBubbleChart(topicData) {
	// parse the JSON data
	var trendData = JSON.parse(topicData);
	// get just the data, we don't need the metadata
	trendData = trendData['data'];
	// sort the keys alphabetically
	var trends = _.keys(trendData);
	trends = trends.sort();
	
	// enable jqplot plugins
	$.jqplot.config.enablePlugins = true;
	
	//
	// build the trend bubble chart
	//
	var bubbleData = [];
	// create an array of bubble data for each trend based upon its number of mentions
	trends.forEach(function(trend, index){
		var name = trendData[trend].name;
		var mentions = trendData[trend].mentions;
		bubbleData.push([index, mentions, mentions, name]);
	});
	
	var trendBubbleChart = $.jqplot('trend_bubble', [bubbleData], {
		title: 'Trends x Mentions' + ' (' + trends.length + ' trends in total)',
     seriesDefaults:{
         renderer: $.jqplot.BubbleRenderer,
         rendererOptions: {
             bubbleAlpha: 0.6,
             highlightAlpha: 0.8,
             showLabels: false,
             autoscaleMultiplier: 1.5,
         },
         shadow: true,
         shadowAlpha: 0.05,
     },
     axes: {
         renderer: $.jqplot.CategoryAxisRenderer,
         xaxis: {
         	min: -5,
         	max: 100,
             tickOptions: {
                 formatString: '%d'
             },
             label: 'Trend Index'
         }
     },
     highlighter: {
         tooltipContentEditor: function (str, seriesIndex, pointIndex) {
         	var data = bubbleData[pointIndex];
				var html = '<ul>';
				html = html + '<li><em>Topic: </em>' + S(data[3]).truncate(50).s + '</li>';
				html = html + '<li><em>Index: </em>' + data[0] + '</li>';
				html = html + '<li><em>Mentions: </em>' + data[2] + '</li>'; 
				html = html + '</ul>';
             return html;
         },
         sizeAdjust: 10,
         tooltipLocation: 'n',
         tooltipAxes: 'both',
         useAxesFormatters: false
     },
     cursor:{zoom:true}
	});
	
	$('#trend_bubble').bind('jqplotDataClick',
	       function (ev, seriesIndex, pointIndex, data, radius) { 
				var html = '<ul>';
				html = html + '<li>Topic: ' + data[3] + '</li>';
				html = html + '<li>Index: ' + data[0] + '</li>';
				html = html + '<li>Mentions: ' + data[2] + '</li>';		
				html = html + '</ul>';
				$('#trend_info').html(html);
	       });
}

/**
 * Create the trends frequency of mentions bar chart
 *
 * @param {String}
 * @return {Void}
 */
function createTrendsBarChart(mentionsData) {
	// parse the JSON data
	var json = JSON.parse(mentionsData);
	// get just the data, we don't need the metadata
	json = json['data'];
	// sort the keys numerically
	var mentions = _.keys(json);
	// enable jqplot plugins
	$.jqplot.config.enablePlugins = true;
	
	//
	// build the bar chart
	//
	var barData = [];
	mentions.forEach(function(mention, index){
		var list = json[mention];
		barData.push([mention, list.length]);
	});	

	var trendBarChart = $.jqplot('trend_bar', [barData], {
		// get the title of the chart from the data
		title: 'Frequency Distribution of Trend Mentions',
		seriesDefaults: {
			renderer:$.jqplot.BarRenderer,
			// place the numerical values above each bar
			pointLabels: {show: true},
		},
		axesDefaults: {
			tickRenderer: $.jqplot.CanvasAxisTickRenderer,
			tickOptions: {
				fontSize: '9pt'
			}
		},
		axes: {
			yaxis: {
				labelRenderer: $.jqplot.CanvasAxisLabelRenderer,
				label: '# of Trends',
			},
			xaxis: {
				renderer: $.jqplot.CategoryAxisRenderer,
				label: '# of Mentions'
			}
		},
     highlighter: {
         tooltipContentEditor: function (str, seriesIndex, pointIndex) {
          	var data = barData[pointIndex];
			var t = (data[1] == 1) ? ' topic ' : ' topics ';
			var m = (data[0] == 1) ? ' mention' : ' mentions';
			var html = data[1] + t + ' had ' + data[0] + m;
			if (data[1] < 7) {
	  			var topics = '';
				var val = barData[pointIndex][0];
				var key = val.toString();
				json[key].forEach(function(topic){
					topics = topics + '<li>' + topic.name + '</li>';
				});
				html = html + '<ul>' + topics + '</ul>'
			}
			return html;
         },
         sizeAdjust: 10,
         tooltipLocation: 'n',
         tooltipAxes: 'both',
         useAxesFormatters: false
     },
	});
}

/**
 * Create the table of data about trends
 * 
 * @param {String}
 * @return {Object}
 */
function createTrendsDataTable(data) {
	// parse the JSON data
	var trendData = JSON.parse(data);
	// get just the data, we don't need the metadata
	trendData = trendData['data'];
	// sort the keys alphabetically
	var trends = _.keys(trendData);
	// create the data for our table
	var tableData = [];
	trends.forEach(function(trend, index){
		var name = trendData[trend].name;
		var desc = trendData[trend].description;
		var mentions = trendData[trend].mentions;
		tableData.push([index, name, desc, mentions]);
	});
	
	var trendDataTable = $('#trend_table').removeAttr('width').dataTable({
		'destroy':true, // reset the contents of the table each time the function is invoked
		'data':tableData,
		'columns': [
		            {'title':'Index'},
		            {'title':'Name'},
		            {'title':'Description'},
		            {'title':'Mentions'}],
		'lengthMenu':[[5,10,-1],[5,10,'All']],
     'scrollY':        '200px',
     'scrollX':        true,
     'scrollCollapse': true,
     'paging':         false,
		'fixedColumns':true,
		'columnDefs': [{'width': 200, 'targets':2}]
	});
	// set defaults on the table
 $.extend($.fn.dataTable.defaults, {
     "bPaginate": true,
     "bInfo": true,
 });
	// resize the table to fit the data in the columns
	trendDataTable.fnAdjustColumnSizing();
	trendDataTable.fnSort([[0, 'asc']]);
	
	// return the trends data table for later use
	return trendDataTable;
}

 /**
  * Given a metadata object, add its contents to the
  * datasets dialog
  * 
  * @param {String} The name of the dataset 
  * @param {Object} The metadata for the dataset
  * @return {Void}
  */
function addDatasetMetadata(dataset, metadata) {
	$('#dataset_dialog').dialog('close');
	var keys = _.keys(metadata);
	$('#dataset_info').append('<p><em>' + dataset + '</em><br/>');
	$('#dataset_info').append('<ul>');
	keys.forEach(function(key){
		$('#dataset_info').append('<li><em>' + key + '</em>: ' + metadata[key]);
	});
	$('#dataset_info').append('</ul></p>');	
	$('#dataset_dialog').dialog('close');
}

// 
//
// Initialize the UI elements
//
$(document).ready(function(){
	// initialize trend ui elements
	$('#trend_dialog').dialog({
		modal: true,
		buttons: {
		  Ok: function() {
		    $(this).dialog('close');
		  }
		}
	});
	$('#trend_dialog').dialog({'minWidth':500});
	$('#trend_dialog').dialog('close');
	$('#trend_button').button().click(function(event) {
        $('#trend_dialog').dialog('open');
    });
	
	// create the trends bubble chart
	$.ajax({
		url: datasets['Trends'].source_by_topic,
		dataType: 'text'
	}).done(function(data){
		var metadata = JSON.parse(data)['metadata'];
		addDatasetMetadata('Trends x Mentions', metadata);
		// add dataset information to the 
		// create the trends bubble chart
		createTrendsBubbleChart(data);
		// create the table data
		var trendsTable = createTrendsDataTable(data);
		trendsTable.fnDraw();
	}).fail(function(){
		alert('Read of: ' + url + ' failed.');
	});
	
	// create the trends bar chart
	$.ajax({
		url: datasets['Trends'].source_by_mentions,
		dataType: 'text'
	}).done(function(data){
		var metadata = JSON.parse(data)['metadata'];
		addDatasetMetadata('Frequency of Trend Mentions', metadata);
		// create the trends bar chart
		createTrendsBarChart(data);
	}).fail(function(){
		alert('Read of: ' + url + ' failed.');
	});
});
</script>

</body>
</html>
